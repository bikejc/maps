(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[71],{3071:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Map_Map}});var r=n(1527),o=n(959),l=n(3852),i=n.n(l),c=n(9772),a=n.n(c),u=n(8935);function extendContext(e,t){return Object.freeze({...e,...t})}let s=(0,o.createContext)(null),f=s.Provider;function useLeafletContext(){let e=(0,o.useContext)(s);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}var d=n(422);function element_createElementObject(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function element_createElementHook(e,t){return null==t?function(t,n){let r=(0,o.useRef)();return r.current||(r.current=e(t,n)),r}:function(n,r){let l=(0,o.useRef)();l.current||(l.current=e(n,r));let i=(0,o.useRef)(n),{instance:c}=l.current;return(0,o.useEffect)(function(){i.current!==n&&(t(c,n,i.current),i.current=n)},[c,n,r]),l}}function useAttribution(e,t){let n=(0,o.useRef)(t);(0,o.useEffect)(function(){t!==n.current&&null!=e.attributionControl&&(null!=n.current&&e.attributionControl.removeAttribution(n.current),null!=t&&e.attributionControl.addAttribution(t)),n.current=t},[e,t])}function useEventHandlers(e,t){let n=(0,o.useRef)();(0,o.useEffect)(function(){return null!=t&&e.instance.on(t),n.current=t,function(){null!=n.current&&e.instance.off(n.current),n.current=null}},[e,t])}function withPane(e,t){let n=e.pane??t.pane;return n?{...e,pane:n}:e}function useLayerLifecycle(e,t){(0,o.useEffect)(function(){let n=t.layerContainer??t.map;return n.addLayer(e.instance),function(){t.layerContainer?.removeLayer(e.instance),t.map.removeLayer(e.instance)}},[t,e])}function createPathComponent(e,t){var n;let r=element_createElementHook(e,t);return n=function(e){let t=useLeafletContext(),n=r(withPane(e,t),t);return useEventHandlers(n.current,e.eventHandlers),useLayerLifecycle(n.current,t),function(e,t){let n=(0,o.useRef)();(0,o.useEffect)(function(){if(t.pathOptions!==n.current){let r=t.pathOptions??{};e.instance.setStyle(r),n.current=r}},[e,t])}(n.current,e),n},(0,o.forwardRef)(function(e,t){let{instance:r,context:l}=n(e).current;return(0,o.useImperativeHandle)(t,()=>r),null==e.children?null:o.createElement(f,{value:l},e.children)})}let p=createPathComponent(function({positions:e,...t},n){let r=new l.Polygon(e,t);return element_createElementObject(r,extendContext(n,{overlayContainer:r}))},function(e,t,n){t.positions!==n.positions&&e.setLatLngs(t.positions)}),m=function(e,t){var n;let r=element_createElementHook(e);return n=function(e,n){let o=useLeafletContext(),l=r(withPane(e,o),o);return useAttribution(o.map,e.attribution),useEventHandlers(l.current,e.eventHandlers),t(l.current,o,e,n),l},(0,o.forwardRef)(function(e,t){let[r,l]=(0,o.useState)(!1),{instance:i}=n(e,l).current;(0,o.useImperativeHandle)(t,()=>i),(0,o.useEffect)(function(){r&&i.update()},[i,r,e.children]);let c=i._contentNode;return c?(0,d.createPortal)(e.children,c):null})}(function(e,t){let n=new l.Tooltip(e,t.overlayContainer);return element_createElementObject(n,t)},function(e,t,{position:n},r){(0,o.useEffect)(function(){let o=t.overlayContainer;if(null==o)return;let{instance:l}=e,onTooltipOpen=e=>{e.tooltip===l&&(null!=n&&l.setLatLng(n),l.update(),r(!0))},onTooltipClose=e=>{e.tooltip===l&&r(!1)};return o.on({tooltipopen:onTooltipOpen,tooltipclose:onTooltipClose}),o.bindTooltip(l),function(){o.off({tooltipopen:onTooltipOpen,tooltipclose:onTooltipClose}),null!=o._map&&o.unbindTooltip()}},[e,t,r,n])}),v=createPathComponent(function({positions:e,...t},n){let r=new l.Polyline(e,t);return element_createElementObject(r,extendContext(n,{overlayContainer:r}))},function(e,t,n){t.positions!==n.positions&&e.setLatLngs(t.positions)}),b=createPathComponent(function({center:e,children:t,...n},r){let o=new l.Circle(e,n);return element_createElementObject(o,extendContext(r,{overlayContainer:o}))},function(e,t,n){t.center!==n.center&&e.setLatLng(t.center),null!=t.radius&&t.radius!==n.radius&&e.setRadius(t.radius)}),h=function(e,t){var n;let r=element_createElementHook(e,t);return n=function(e){let t=useLeafletContext(),n=r(withPane(e,t),t);return useAttribution(t.map,e.attribution),useEventHandlers(n.current,e.eventHandlers),useLayerLifecycle(n.current,t),n},(0,o.forwardRef)(function(e,t){let{instance:r}=n(e).current;return(0,o.useImperativeHandle)(t,()=>r),null})}(function({url:e,...t},n){let r=new l.TileLayer(e,withPane(t,n));return element_createElementObject(r,n)},function(e,t,n){!function(e,t,n){let{opacity:r,zIndex:o}=t;null!=r&&r!==n.opacity&&e.setOpacity(r),null!=o&&o!==n.zIndex&&e.setZIndex(o)}(e,t,n);let{url:r}=t;null!=r&&r!==n.url&&e.setUrl(r)});function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}let x=(0,o.forwardRef)(function({bounds:e,boundsOptions:t,center:n,children:r,className:i,id:c,placeholder:a,style:u,whenReady:s,zoom:d,...p},m){let[v]=(0,o.useState)({className:i,id:c,style:u}),[b,h]=(0,o.useState)(null);(0,o.useImperativeHandle)(m,()=>b?.map??null,[b]);let x=(0,o.useCallback)(r=>{if(null!==r&&null===b){let o=new l.Map(r,p);null!=n&&null!=d?o.setView(n,d):null!=e&&o.fitBounds(e,t),null!=s&&o.whenReady(s),h(Object.freeze({__version:1,map:o}))}},[]);(0,o.useEffect)(()=>()=>{b?.map.remove()},[b]);let E=b?o.createElement(f,{value:b},r):a??null;return o.createElement("div",_extends({},v,{ref:x}),E)});function MapLayer(e){let{activeLayerIndices:t,fetchedLayers:n,activeLayers:l,setLL:i,setZoom:c}=e,a=function(e){let t=useLeafletContext().map;return(0,o.useEffect)(function(){return t.on(e),function(){t.off(e)}},[t,e]),t}({move:()=>i(a.getCenter(),"replaceIn"),zoom:()=>c(a.getZoom(),"replaceIn")}),{url:s,attribution:f}=u.MAPS.alidade_smooth_dark;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h,{url:s,attribution:f}),"wards"in n&&l.includes("wards")&&(()=>{var e;let o=t.wards;return null===(e=n.wards)||void 0===e?void 0:e.map(e=>{let{attributes:t,geometry:n}=e,l=t.NAME,i=u.Ls[l],c=i.color,a=i.councillor,s="ward-".concat(l,"_rank").concat(o);return n.rings.map(e=>(e=e.map(e=>{let[t,n]=e;return[n,t]}),(0,r.jsx)(p,{style:{zIndex:1},weight:1,color:"black",fillColor:c,positions:e,fillOpacity:.2,children:(0,r.jsxs)(m,{sticky:!0,children:[(0,r.jsxs)("span",{children:["Ward ",l,":"]})," ",(0,r.jsx)("span",{children:a})]})},s)))})})(),"roads"in n&&l.includes("roads")&&(()=>{var e;let o=t.roads;return null===(e=n.roads)||void 0===e?void 0:e.map(e=>{let{attributes:t,geometry:n}=e,{OBJECTID:l,LocalName:i,DIRECTION:c,MEASURED_L:a}=t,u="".concat(i,": ").concat(a,"mi");return(c=c.trim())&&(u="".concat(u,", ").concat(c)),n.paths.map((e,t)=>{let n="".concat(i,"_").concat(l,"_").concat(t,"_rank").concat(o);return e=e.map(e=>{let[t,n]=e;return[n,t]}),(0,r.jsx)(v,{color:"red",positions:e,children:(0,r.jsx)(m,{sticky:!0,children:u})},n)})})})(),"bikeLanes"in n&&l.includes("bikeLanes")&&(()=>{var e;let o=t.bikeLanes;return null===(e=n.bikeLanes)||void 0===e?void 0:e.map(e=>{var t;let{attributes:n,geometry:l}=e,{OBJECTID:i,Street_Name:c,Type:a,Status:s}=n;if("TABLED"===s)return;c=c||n.StreetName;let f="PLANNED"===s?"PLANNED ".concat(a):a;if("PROTECTED BIKE LANE"!==f&&"PLANNED PROTECTED BIKE LANE"!==f)return;let d=(null===(t=u.Hv[null==f?void 0:f.trim()])||void 0===t?void 0:t.color)||"black";return l.paths.map((e,t)=>{e=e.map(e=>{let[t,n]=e;return[n,t]});let n="".concat(i,"_").concat(t,"_rank").concat(o);return(0,r.jsx)(v,{color:d,positions:e,children:(0,r.jsxs)(m,{sticky:!0,children:[c,", ",f]})},n)})})})(),"citibike"in n&&l.includes("citibike")&&(()=>{var e;let o=t.citibike;return null===(e=n.citibike)||void 0===e?void 0:e.map(e=>{let{attributes:t,geometry:n}=e,{OBJECTID:l,Location:i,StationID:c}=t,a=[n.y,n.x],u="".concat(l,"_rank").concat(o);return(0,r.jsx)(b,{center:a,color:"lightblue",radius:10,opacity:1,weight:10,fill:!0,fillColor:"lightblue",fillOpacity:1,children:(0,r.jsxs)(m,{sticky:!0,children:[i," (",c,")"]})},u)})})(),"bmp"in n&&l.includes("bmp")&&(()=>{var e;let o=t.bmp;return null===(e=n.bmp)||void 0===e?void 0:e.map((e,t)=>{var n;let{properties:l,geometry:i}=e,{Street:c,Type:a,Direction:s,Lane_count:f}=l,d=(null===(n=u.zQ[null==a?void 0:a.trim()])||void 0===n?void 0:n.color)||"black";if("LineString"!==i.type){console.warn("Street ".concat(c,", geometry type ").concat(i.type));return}let p=i.coordinates.map(e=>{let[t,n]=e;return[n,t]}),b="".concat(c,"_").concat(t,"_rank").concat(o);return(0,r.jsx)(v,{color:d,positions:p,children:(0,r.jsxs)(m,{sticky:!0,children:[c," (",a,", ",s,"/b",f&&", ".concat(f," lanes"),")"]})},b)})})(),"HIN"in n&&l.includes("HIN")&&(()=>{var e;let o=t.HIN;return null===(e=n.HIN)||void 0===e?void 0:e.map(e=>{let{geometry:t}=e;return t.paths.map((e,t)=>(0,r.jsx)(v,{positions:e.map(e=>{let[t,n]=e;return[n,t]}),color:"orange"},"HIN_".concat(t,"_rank").concat(o)))})})(),"lur"in n&&l.includes("lur")&&(()=>{let e=n.lur;return e&&(0,r.jsx)(v,{color:"red",positions:e},"lur")})()]})}var Map_Map=e=>{let{className:t,activeLayerIndices:n,fetchedLayers:l,activeLayers:c,setLL:u,setZoom:s,...f}=e,d=a().map;return t&&(d="".concat(d," ").concat(t)),(0,o.useEffect)(()=>{!async function(){delete i().Icon.Default.prototype._getIconUrl,i().Icon.Default.mergeOptions({iconRetinaUrl:"/_next/static/media/marker-icon-2x.93fdb12c.png",iconUrl:"/_next/static/media/marker-icon.d577052a.png",shadowUrl:"/_next/static/media/marker-shadow.612e3b52.png"})}()},[]),(0,r.jsx)(x,{className:d,...f,children:(0,r.jsx)(MapLayer,{activeLayerIndices:n,fetchedLayers:l,activeLayers:c,setLL:u,setZoom:s})})}},9772:function(e){e.exports={map:"Map_map__QBpSd"}}}]);