(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{1195:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return o(7693)}])},4993:function(e,t,o){"use strict";var n=o(152),r=o.n(n);let a=r()(()=>Promise.all([o.e(48),o.e(71)]).then(o.bind(o,3071)),{loadableGenerated:{webpack:()=>[3071]},ssr:!1});t.Z=a},8935:function(e,t,o){"use strict";o.d(t,{Hv:function(){return r},Ls:function(){return n},MAPS:function(){return c},Wl:function(){return i},oJ:function(){return l},yj:function(){return s},zQ:function(){return a}});let n={A:{color:"#ff0000",councillor:"Denise Ridley"},B:{color:"#ff8800",councillor:"Mira Prinz-Arey"},C:{color:"#ffff00",councillor:"Rich Boggiano"},D:{color:"#00ff00",councillor:"Yousef Saleh"},E:{color:"#0000ff",councillor:"James Solomon"},F:{color:"#ff00ff",councillor:"Frank Gilmore"}},r={"PROTECTED BIKE LANE":{color:"#26de3b"},"PLANNED PROTECTED BIKE LANE":{color:"#b122e0"},"SHARED USE LANE":{color:"#FFFF00"},"SHARED USE PATH":{color:"#00FFFF"}},a={"NEIGHBORHOOD GREENWAY":{color:"lightblue"},"BIKE LANE":{color:"lightorange"},"PROTECTED BIKE LANE":{color:"lightgreen"},"SHARED USE LANE":{color:"lightred"},"SHARED USE PATH":{color:"lightyellow"}},c={openstreetmap:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"&copy; <a href=&quot;http://osm.org/copyright&quot;>OpenStreetMap</a> contributors"},alidade_smooth_dark:{url:"https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}},s={wards:"wards.json",roads:"Roads_Jersey_City.json",lur:"light-up-route-20220708.gpx",citibike:"JC_Citi_Bike_Locations.json",HIN:"Vision_Zero_Traffic_Calming_Projects_WFL1/Merged_HIN.json",counties:"County_Boundaries_of_NJ.geojson",county2:"County_Boundaries_of_NJ_2x.geojson",county5:"County_Boundaries_of_NJ_5x.geojson",county10:"County_Boundaries_of_NJ_10x.geojson",bmp:"Proposed Full Network.geojson"},i=[{label:"Bike Lanes",key:"bikeLanes"},{label:"Roads",key:"roads"},{label:"Wards",key:"wards"},{label:"Citi Bike Docks",key:"citibike"},{label:"High Injury Network",key:"HIN"},{label:"Counties",key:"counties"},{label:"Counties/2",key:"county2"},{label:"Counties/5",key:"county5"},{label:"Counties/10",key:"county10"},{label:"Bike Master Plan",key:"bmp"}],l=["wards","counties","county2","county5","county10","roads","HIN","bmp","bikeLanes","citibike"]},7693:function(e,t,o){"use strict";o.r(t),o.d(t,{__N_SSG:function(){return j},default:function(){return Home}});var n=o(1527),r=o(3764),a=o.n(r),c=o(8686),s=o.n(c),i=o(4225),l=o(4993),u=o(4447),d=o.n(u),m=o(959),p=o(8935),f=o(513),_=o(4215);let h={lat:40.72,lng:-74.066},g=p.Wl.filter(e=>{let{key:t}=e;return["wards","roads","bmp","bikeLanes","citibike","HIN"].includes(t)}),y=g.map(e=>{let{key:t}=e;return t});var j=!0;function Home(e){let{layers:t}=e,o={l:(0,f.W$)({init:["wards","bikeLanes"],allValues:y,mapper:{wards:"w",bikeLanes:"b",citibike:"c",bmp:"p",roads:"r",HIN:"h"},delim:""}),ll:(0,f.GS)(h,3),z:(0,f.yc)(13)},{ll:[{lat:r,lng:c},u],z:[j,b],l:[k,{add:x,remove:E}]}=(0,f.O5)({params:o}),w=(0,m.useMemo)(()=>Array.from(k).map(e=>[p.oJ.indexOf(e),e]).sort((e,t)=>{let[o]=e,[n]=t;return o-n}).map(e=>{let[t,o]=e;return o}),[k]),[N,v]=(0,m.useReducer)((e,t)=>{let[o,n]=t;if(o in e)return e[o]?(console.warn("fetchLayers: duplicate add ".concat(o)),e):(console.log("fetchLayers: updating ".concat(o," (now ").concat(null==n?void 0:n.length," elems):"),n),Object.fromEntries(Object.entries(e).map(e=>{let[t,r]=e;return t===o?[t,n]:[t,r]})));{console.log("fetchLayers: setting ".concat(o,": ").concat(n));let t={...e};return t[o]=n,t}},t),P=(0,m.useMemo)(()=>Object.fromEntries(w.filter(e=>e in N&&N[e]).map((e,t)=>[e,t])),[N,w]),[S,C]=(0,m.useState)(!1),[H,L]=(0,m.useState)(!1),O=window.location.href||void 0,A=null==O?void 0:O.match(f.z1),M=A?A[0]:O,B=(0,m.useMemo)(()=>{let e;let t=[];return w.includes("wards")&&t.push(["Wards"]),w.includes("roads")&&t.push(["Roads"]),w.includes("bikeLanes")&&t.push(["Protected Bike Lanes"]),w.includes("HIN")&&t.push(["High Injury Network"]),w.includes("bmp")&&t.push(["Bike Master Plan"]),w.includes("citibike")&&t.push(["Citi Bike Docks"]),console.log(w,e=0===t.length?null:"JC ".concat(t.join(", ")),t),e},[w]);(0,m.useEffect)(()=>{let fetchLayer=async e=>{let t;if(!O)return Promise.resolve();if(e in N)return N[e]?console.log("".concat(e,": already fetched")):console.log("".concat(e,": currently fetching")),Promise.resolve();v([e,null]);let o=p.yj[e],n="".concat(M,"/").concat(o);console.log("fetching layer: ".concat(e,", url: ").concat(n));let r=await fetch(n);if(console.log("fetched layer: ".concat(e)),"lur"===e){let e=await r.text(),o=new i.XMLParser({ignoreAttributes:!1}),n=o.parse(e),a=n.gpx.trk.trkseg.trkpt,c=a.map(e=>[parseFloat(e["@_lat"]),parseFloat(e["@_lon"])]);t=c,console.log("got gpx positions:",c)}else{let o=await r.json();t=o.features,console.log("layer ".concat(e,":"),t)}return v([e,t]),x(e),Promise.resolve()};Promise.all(w.map(fetchLayer)).catch(console.error)},[w]);let F=(0,_.useRouter)(),R=F.basePath;return(0,n.jsxs)("div",{className:d().container,children:[(0,n.jsxs)(a(),{children:[(0,n.jsx)("title",{children:B}),(0,n.jsx)("link",{rel:"icon",href:"".concat(R,"/favicon.ico")}),(0,n.jsx)("link",{rel:"stylesheet",href:"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"}),(0,n.jsx)("meta",{name:"twitter:card",content:"summary"},"twcard"),(0,n.jsx)("meta",{name:"twitter:creator",content:"RunsAsCoded"},"twhandle"),(0,n.jsx)("meta",{property:"og:url",content:"https://map.bikejc.org"},"ogurl"),(0,n.jsx)("meta",{property:"og:type",content:"website"}),(0,n.jsx)("meta",{property:"og:image",content:"https://map.bikejc.org/screenshots/pbls.png"},"ogimage"),(0,n.jsx)("meta",{property:"og:site_name",content:"JC Bike Lane Map"},"ogsitename"),(0,n.jsx)("meta",{property:"og:title",content:"JC Bike Lane + Ward Map"},"ogtitle"),(0,n.jsx)("meta",{property:"og:description",content:"â‰ˆ10 protected bike lanes overlaid on the 6 council wards"},"ogdesc")]}),(0,n.jsx)("main",{className:d().main,children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.Z,{className:d().homeMap,center:{lat:r,lng:c},zoom:j,zoomControl:!1,zoomSnap:.5,zoomDelta:.5,activeLayerIndices:P,fetchedLayers:N,activeLayers:w,setLL:u,setZoom:b}),(0,n.jsx)("div",{className:d().title,children:B}),(0,n.jsx)("div",{className:s().gearContainer,onMouseEnter:()=>L(!0),onMouseLeave:()=>L(!1),children:(0,n.jsxs)("div",{className:s().settings,children:[(0,n.jsx)("i",{className:"fa fa-gear ".concat(s().gear),onClick:()=>C(!S)}),(S||H)&&(0,n.jsxs)("div",{className:s().menu,children:[(0,n.jsx)("ul",{className:s().layers,children:g.map(e=>{let{label:t,key:o}=e,r=w.includes(o);return(0,n.jsx)("li",{children:(0,n.jsxs)("label",{children:[(0,n.jsx)("input",{type:"checkbox",onChange:function(e){let t=e.target.checked;t===r&&console.error("layer ".concat(o,": checked ").concat(t," != active ").concat(r)),t?x(o):E(o)},checked:r}),t]})},o)})}),(0,n.jsxs)("div",{className:s().icons,children:[(0,n.jsx)("a",{href:"https://github.com/bikejc/maps",children:(0,n.jsx)("img",{alt:"GitHub logo",className:s().icon,src:"".concat(R,"/gh.png")})}),(0,n.jsx)("a",{href:"https://bikejc.org",children:(0,n.jsx)("img",{alt:"Bike JC logo",className:s().icon,src:"".concat(R,"/logo.png")})})]})]})]})})]})})]})}},513:function(e,t,o){"use strict";o.d(t,{GS:function(){return llParam},O5:function(){return parseQueryParams},W$:function(){return enumMultiParam},yc:function(){return floatParam},z1:function(){return c}});var n=o(4215),r=o(959),a=o(2017);let c=/[^?#]+/u;function llParam(e,t){return{encode:o=>{let{lat:n,lng:r}=o;return n===e.lat&&r===e.lng?void 0:t?"".concat(n.toFixed(t),"_").concat(r.toFixed(t)):"".concat(n,"_").concat(r)},decode:t=>{if(!t)return e;let[o,n]=t.split("_").map(parseFloat);return{lat:o,lng:n}}}}function floatParam(e){return{encode:t=>t===e?void 0:t.toString(),decode:t=>t?parseFloat(t):e}}function enumMultiParam(e){let t,{init:o,allValues:n,mapper:r,delim:c}=e;function verify(e){return Array.from(e).filter(e=>!!n.includes(e)||(console.warn("Invalid value: ".concat(e," not in ").concat(n)),!1))}c=void 0===c?"_":c,r&&(t=Object.fromEntries(Object.entries(r).map(e=>{let[t,o]=e;return[o,t]})));let encode=e=>(e=verify(e),r&&(e=e.map(e=>r[e])),e.join(c)),s=encode(o);return{encode:e=>{let t=encode(e);if(t!==s)return t},decode:e=>{if(!e&&""!==e)return o;let n=e.split(c);return t&&(n=n.filter(e=>e in t||(console.warn("Unrecognized value: ".concat(e," not in ").concat(Object.keys(t).join(","))),!1)).map(e=>t[e])),n=verify(n)},use:a.$}}function parseQueryParams(e){let{params:t}=e,o=(0,n.useRouter)(),a=o.asPath.replace(c,""),s=Object.fromEntries(new URLSearchParams(a).entries()),i=Object.fromEntries(Object.entries(t).map(e=>{let[t,o]=e,[n,a]=(o.use||r.useState)(o.decode(s[t]));return[t,{val:n,set:a,param:o}]})),l=Object.values(i).map(e=>{let{val:t}=e;return t}),u=o.asPath.match(c),d=u?u[0]:o.asPath;return(0,r.useEffect)(()=>{let e={};Object.entries(i).map(t=>{let[o,{val:n,param:r}]=t,a=r.encode(n);void 0!==a&&(e[o]=a)});let t=new URLSearchParams(e).toString();o.replace({pathname:o.pathname,hash:"",search:t},{pathname:d,hash:"",search:t},{shallow:!0,scroll:!1})},[...l,d]),Object.fromEntries(Object.entries(i).map(e=>{let[t,{val:o,set:n}]=e;return[t,[o,n]]}))}},2017:function(e,t,o){"use strict";o.d(t,{$:function(){return useSet}});var n=o(959);let useSet=e=>{let[t,o]=(0,n.useState)(new Set(e)),r=(0,n.useMemo)(()=>({add:e=>o(t=>(console.log("prevSet:",t),new Set([...t,e]))),remove:e=>o(t=>new Set([...t].filter(t=>t!==e))),clear:()=>o(new Set)}),[o]);return[t,r]}},4447:function(e){e.exports={container:"Home_container__d256j",main:"Home_main__VkIEL",footer:"Home_footer__yFiaX",title:"Home_title__hYX6j",description:"Home_description__uXNdx",code:"Home_code__VVrIr",grid:"Home_grid__AVljO",card:"Home_card__E5spL",logo:"Home_logo__IOQAX",homeMap:"Home_homeMap___bL1q"}},8686:function(e){e.exports={gearContainer:"index_gearContainer__ulsne",gear:"index_gear__gPxB6",settings:"index_settings__OvHyN",menu:"index_menu__CCGxo",layers:"index_layers__WU_5m",icons:"index_icons__SvAZO",icon:"index_icon__6tE9W"}}},function(e){e.O(0,[293,774,888,179],function(){return e(e.s=1195)}),_N_E=e.O()}]);