(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(7737)}])},7737:function(e,n,t){"use strict";t.r(n),t.d(n,{__N_SSG:function(){return C},default:function(){return P}});var r=t(7568),o=t(1799),c=t(9396),a=t(828),i=t(9815),s=t(4051),l=t.n(s),u=t(5893),d=t(9008),f=t.n(d),p=t(6719),m=t.n(p),h=t(6932),_=t(5152),g=t.n(_)()((function(){return Promise.all([t.e(269),t.e(115)]).then(t.bind(t,4115))}),{loadableGenerated:{webpack:function(){return[4115]}},ssr:!1}),x=t(214),k=t.n(x),v=t(7294),b=[40.72,-74.066],y={A:{color:"#ff0000",councillor:"Denise Ridley"},B:{color:"#ff8800",councillor:"Mira Prinz-Arey"},C:{color:"#ffff00",councillor:"Rich Boggiano"},D:{color:"#00ff00",councillor:"Yousef Saleh"},E:{color:"#0000ff",councillor:"James Solomon"},F:{color:"#ff00ff",councillor:"Frank Gilmore"}},j={"PROTECTED BIKE LANE":{color:"#26de3b"},"PLANNED PROTECTED BIKE LANE":{color:"#b122e0"},"SHARED USE LANE":{color:"#FFFF00"},"SHARED USE PATH":{color:"#00FFFF"}},N={url:"https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'},E={roads:"Roads_Jersey_City.json",lur:"light-up-route-20220708.gpx",citibike:"JC_Citi_Bike_Locations.json",HIN:"Vision_Zero_Traffic_Calming_Projects_WFL1/Merged_HIN.json"},L=[{label:"Bike Lanes",key:"bikeLanes"},{label:"Roads",key:"roads"},{label:"Wards",key:"wards"},{label:"Citi Bike Docks",key:"citibike"},{label:"High Injury Network",key:"HIN"}],w=["wards","roads","HIN","bikeLanes","citibike"];var C=!0;function P(e){var n=e.layers,t=(0,a.Z)(function(e){var n=(0,v.useState)(new Set(e)),t=n[0],r=n[1];return[t,(0,v.useMemo)((function(){return{add:function(e){return r((function(n){return new Set((0,i.Z)(n).concat([e]))}))},remove:function(e){return r((function(n){return new Set((0,i.Z)(n).filter((function(n){return n!==e})))}))},clear:function(){return r(new Set)}}}),[r])]}(["wards","bikeLanes","citibike"]),2),s=t[0],d=t[1],p=d.add,_=d.remove,x=Array.from(s).map((function(e){return[w.indexOf(e),e]})).sort((function(e,n){return(0,a.Z)(e,1)[0]-(0,a.Z)(n,1)[0]})).map((function(e){var n=(0,a.Z)(e,2);n[0];return n[1]})),C=(0,v.useReducer)((function(e,n){var t=(0,a.Z)(n,2),r=t[0],c=t[1];if(r in e)return c[r]?(console.warn("fetchLayers: duplicate add ".concat(r)),e):(console.log("fetchLayers: updating ".concat(r," (").concat(c.length," elems)")),Object.fromEntries(Object.entries(e).map((function(e){var n=(0,a.Z)(e,2),t=n[0],o=n[1];return t===r?[t,c]:[t,o]}))));console.log("fetchLayers: setting ".concat(r,": ").concat(c));var i=(0,o.Z)({},e);return i[r]=c,i}),n),P=C[0],H=C[1];console.log("render: fetchedLayers:",P);var I=(0,v.useMemo)((function(){return Object.fromEntries(x.filter((function(e){return e in P&&P[e]})).map((function(e,n){return[e,n]})))}),[P,x]),S=(0,v.useState)(!1),T=S[0],D=S[1],A=(0,v.useState)(!1),M=A[0],O=A[1],Z=window.location.href,B=(0,v.useMemo)((function(){var e,n=[];return x.includes("bikeLanes")&&n.push(["Protected Bike Lanes"]),x.includes("roads")&&n.push(["Roads"]),x.includes("wards")&&n.push(["Wards"]),0===n.length?e=null:1===n.length?e="JC ".concat(n[0]):2===n.length?e="JC ".concat(n[0]," & ").concat(n[1]):3===n.length&&(e="JC ".concat(n[0],", ").concat(n[1],", & ").concat(n[2])),console.log(x,e,n),e}),[x]);return(0,v.useEffect)((function(){var e=function(){var e=(0,r.Z)(l().mark((function e(n){var t,r,o,c,a,i,s,u,d,f,m;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Z){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:if(!(n in P)){e.next=5;break}return P[n]?console.log("".concat(n,": already fetched")):console.log("".concat(n,": currently fetching")),e.abrupt("return",Promise.resolve());case 5:return H([n,null]),t=E[n],r="".concat(Z,"/").concat(t),console.log("fetching layer: ".concat(n)),e.next=11,fetch(r);case 11:if(o=e.sent,console.log("fetched layer: ".concat(n)),"lur"!==n){e.next=27;break}return e.next=17,o.text();case 17:a=e.sent,i={ignoreAttributes:!1},s=new h.XMLParser(i),u=s.parse(a),d=u.gpx.trk.trkseg.trkpt,f=d.map((function(e){return[parseFloat(e["@_lat"]),parseFloat(e["@_lon"])]})),c=f,console.log("got gpx positions:",f),e.next=32;break;case 27:return e.next=29,o.json();case 29:m=e.sent,c=m.features,console.log("layer ".concat(n,":"),c);case 32:return H([n,c]),p(n),e.abrupt("return",Promise.resolve());case 35:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();Promise.all(x.map(e)).catch(console.error)}),[x]),(0,u.jsxs)("div",{className:k().container,children:[(0,u.jsxs)(f(),{children:[(0,u.jsx)("title",{children:B}),(0,u.jsx)("link",{rel:"icon",href:"./favicon.ico"}),(0,u.jsx)("link",{rel:"stylesheet",href:"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"}),(0,u.jsx)("meta",{name:"twitter:card",content:"summary"},"twcard"),(0,u.jsx)("meta",{name:"twitter:creator",content:"RunsAsCoded"},"twhandle"),(0,u.jsx)("meta",{property:"og:url",content:"https://bikejc.github.io/maps"},"ogurl"),(0,u.jsx)("meta",{property:"og:type",content:"website"}),(0,u.jsx)("meta",{property:"og:image",content:"https://bikejc.github.io/maps/1-pbls.png"},"ogimage"),(0,u.jsx)("meta",{property:"og:site_name",content:"Bike JC Protected Bike Lane Map"},"ogsitename"),(0,u.jsx)("meta",{property:"og:title",content:"JC Protected Bike Lane & Ward Map"},"ogtitle"),(0,u.jsx)("meta",{property:"og:description",content:"\u224810 protected bike lanes overlaid on the 6 council wards"},"ogdesc")]}),(0,u.jsx)("main",{className:k().main,children:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(g,{className:k().homeMap,center:b,zoom:13,zoomControl:!1,children:function(e){return function(e){var n=e.TileLayer,t=(e.Marker,e.Circle),r=e.Polygon,o=e.Polyline,c=(e.ZoomControl,e.Popup,e.Tooltip),i=e.activeLayerIndices,s=e.fetchedLayers,l=e.activeLayers,d=N,f=d.url,p=d.attribution;return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(n,{url:f,attribution:p}),"wards"in s&&l.includes("wards")&&function(){var e,n=i.wards;return null===(e=s.wards)||void 0===e?void 0:e.map((function(e){var t=e.attributes,o=e.geometry,i=t.NAME,s=y[i],l=s.color,d=s.councillor,f="ward-".concat(i,"_rank").concat(n);return o.rings.map((function(e){return e=e.map((function(e){var n=(0,a.Z)(e,2),t=n[0];return[n[1],t]})),(0,u.jsx)(r,{style:{zIndex:1},weight:1,color:"black",fillColor:l,positions:e,fillOpacity:.2,children:(0,u.jsxs)(c,{sticky:!0,children:[(0,u.jsxs)("span",{children:["Ward ",i,":"]})," ",(0,u.jsx)("span",{children:d})]})},f)}))}))}(),"roads"in s&&l.includes("roads")&&function(){var e,n=i.roads;return null===(e=s.roads)||void 0===e?void 0:e.map((function(e){var t=e.attributes,r=e.geometry,i=t.OBJECTID,s=t.LocalName,l=t.DIRECTION,d=t.MEASURED_L,f="".concat(s,": ").concat(d,"mi");return(l=l.trim())&&(f="".concat(f,", ").concat(l)),r.paths.map((function(e,t){var r="".concat(s,"_").concat(i,"_").concat(t,"_rank").concat(n);return e=e.map((function(e){var n=(0,a.Z)(e,2),t=n[0];return[n[1],t]})),(0,u.jsx)(o,{color:"red",positions:e,children:(0,u.jsx)(c,{sticky:!0,children:f})},r)}))}))}(),"bikeLanes"in s&&l.includes("bikeLanes")&&function(){var e,n=i.bikeLanes;return null===(e=s.bikeLanes)||void 0===e?void 0:e.map((function(e){var t,r=e.attributes,i=e.geometry,s=r.OBJECTID,l=r.Street_Name,d=r.Type,f=r.Status;l=l||r.StreetName;var p="PLANNED"===f?"PLANNED ".concat(d):d;if("PROTECTED BIKE LANE"===p||"PLANNED PROTECTED BIKE LANE"===p){var m=(null===(t=j[null===p||void 0===p?void 0:p.trim()])||void 0===t?void 0:t.color)||"black";return i.paths.map((function(e,t){e=e.map((function(e){var n=(0,a.Z)(e,2),t=n[0];return[n[1],t]}));var r="".concat(s,"_").concat(t,"_rank").concat(n);return(0,u.jsx)(o,{color:m,positions:e,children:(0,u.jsxs)(c,{sticky:!0,children:[l,", ",p]})},r)}))}}))}(),"citibike"in s&&l.includes("citibike")&&function(){var e,n=i.citibike;return null===(e=s.citibike)||void 0===e?void 0:e.map((function(e){var r=e.attributes,o=e.geometry,a=r.OBJECTID,i=r.Location,s=r.StationID,l=[o.y,o.x],d="".concat(a,"_rank").concat(n);return(0,u.jsx)(t,{center:l,color:"lightblue",radius:15,children:(0,u.jsxs)(c,{sticky:!0,children:[i," (",s,")"]})},d)}))}(),"HIN"in s&&l.includes("HIN")&&function(){var e,n=i.HIN;return null===(e=s.HIN)||void 0===e?void 0:e.map((function(e){return e.geometry.paths.map((function(e,t){return(0,u.jsx)(o,{positions:e.map((function(e){var n=(0,a.Z)(e,2),t=n[0];return[n[1],t]})),color:"orange"},"HIN_".concat(t,"_rank").concat(n))}))}))}(),"lur"in s&&l.includes("lur")&&function(){var e=s.lur;return e&&(0,u.jsx)(o,{color:"red",positions:e},"lur")}()]})}((0,c.Z)((0,o.Z)({},e),{activeLayerIndices:I,fetchedLayers:P,activeLayers:x}))}}),(0,u.jsx)("div",{className:k().title,children:B}),(0,u.jsx)("div",{className:m().gearContainer,onMouseEnter:function(){return O(!0)},onMouseLeave:function(){return O(!1)},children:(0,u.jsxs)("div",{className:m().settings,children:[(0,u.jsx)("i",{className:"fa fa-gear ".concat(m().gear),onClick:function(){return D(!T)}}),(T||M)&&(0,u.jsxs)("div",{className:m().menu,children:[(0,u.jsx)("ul",{className:m().layers,children:L.map((function(e){var n=e.label,t=e.key,r=x.includes(t);return(0,u.jsx)("li",{children:(0,u.jsxs)("label",{children:[(0,u.jsx)("input",{type:"checkbox",onChange:function(e){var n=e.target.checked;n===r&&console.error("layer ".concat(t,": checked ").concat(n," != active ").concat(r)),n?p(t):_(t)},checked:r}),n]})},t)}))}),(0,u.jsxs)("div",{className:m().icons,children:[(0,u.jsx)("a",{href:"https://github.com/bikejc/maps",children:(0,u.jsx)("img",{alt:"GitHub logo",className:m().icon,src:"./gh.png"})}),(0,u.jsx)("a",{href:"https://bikejc.org",children:(0,u.jsx)("img",{alt:"Bike JC logo",className:m().icon,src:"./logo.png"})})]})]})]})})]})})]})}},214:function(e){e.exports={container:"Home_container__bCOhY",main:"Home_main__nLjiQ",footer:"Home_footer____T7K",title:"Home_title__T09hD",description:"Home_description__41Owk",code:"Home_code__suPER",grid:"Home_grid__GxQ85",card:"Home_card___LpL1",logo:"Home_logo__27_tb",homeMap:"Home_homeMap__ZgfiY"}},6719:function(e){e.exports={gearContainer:"index_gearContainer__hRNDa",gear:"index_gear__jl7gj",settings:"index_settings__hL9ax",menu:"index_menu__vXSVq",layers:"index_layers__Vs_35",icons:"index_icons__4oXXp",icon:"index_icon__IdCia"}}},function(e){e.O(0,[520,774,888,179],(function(){return n=5557,e(e.s=n);var n}));var n=e.O();_N_E=n}]);